# 預約及 AI 客服系統 End-to-End 測試指南

## 📋 測試前準備

### 1. 環境變數檢查

請確認以下環境變數已正確設定在 `.env.local` 或 `.env` 檔案中：

```bash
# Google Sheets API
GOOGLE_SHEETS_ID=你的試算表ID
GOOGLE_SERVICE_ACCOUNT_EMAIL=你的服務帳號Email
GOOGLE_SERVICE_ACCOUNT_KEY=你的服務帳號私鑰（完整JSON，包含換行符）

# Google Calendar API
GOOGLE_CALENDAR_ID=你的日曆ID（通常是Email地址）

# Google Gemini API
GEMINI_API_KEY=你的Gemini API金鑰
```

### 2. 伺服器運行狀態

確認開發伺服器正在運行：
```bash
cd soloai-website
npm run dev
```

預設應在 `http://localhost:3000` 或 `http://localhost:3001` 運行。

---

## 🧪 第一階段：餐廳預約系統測試 (P2-T5)

### 測試步驟

1. **開啟預約頁面**
   - 在瀏覽器中訪問：`http://localhost:3000/reservation`（或您的實際 Port）

2. **填寫表單**
   - **姓名 (Name)**: 輸入測試姓名，例如：`測試用戶`
   - **電話 (Phone)**: 輸入測試電話，例如：`0912345678`
   - **日期 (Date)**: 選擇一個未來的日期（例如：明天或後天）
   - **時間 (Time)**: 從下拉選單選擇一個時段，例如：`11:30 - 14:00 午餐`
   - **人數 (Guests)**: 輸入數字，例如：`2`
   - **特殊需求/備註 (Notes)**: （可選）輸入測試備註，例如：`靠窗座位`

3. **提交表單**
   - 點擊「提交預約」按鈕
   - 觀察頁面反應

### 預期結果

#### ✅ 前端驗證

1. **成功訊息顯示**
   - 應顯示綠色成功訊息框
   - 訊息內容應包含：`預約成功！您的日曆連結是: [連結]`
   - 表單應自動清空

2. **錯誤處理**
   - 如果必填欄位未填寫，應顯示紅色錯誤訊息
   - 如果 API 呼叫失敗，應顯示錯誤訊息

#### ✅ 後端驗證

1. **Google Sheets 寫入驗證**
   - 開啟您的 Google Sheets
   - 找到工作表：`Brunch_Reservations`
   - 檢查最後一筆資料，應包含以下 8 個欄位（A-H）：
     ```
     A: name (姓名)
     B: phone (電話)
     C: date (日期)
     D: time (時段)
     E: guests (人數)
     F: notes (備註)
     G: calendarLink (日曆連結)
     H: timestamp (時間戳記)
     ```
   - **請截圖此筆資料**

2. **Google Calendar 事件驗證**
   - 開啟您的 Google Calendar
   - 找到對應的日曆（使用 `GOOGLE_CALENDAR_ID`）
   - 檢查是否有新的活動被創建
   - 活動標題應為：`[Brunch 預約] 測試用戶 (2人)`
   - 活動描述應包含：電話、時段、備註
   - 活動時間應與選擇的日期和時段一致
   - **請截圖此活動**

---

## 🤖 第二階段：AI 客服系統測試 (P2-T6)

### 測試步驟

1. **開啟聊天視窗**
   - 在網站任何頁面（例如首頁或預約頁面）
   - 找到右下角的**琥珀色浮動按鈕**（聊天氣泡圖示）
   - 點擊按鈕開啟聊天視窗

2. **輸入測試問題**
   - 在輸入框中輸入：`你們的營業時間是什麼時候？`
   - 點擊「發送」按鈕（或按 Enter）

3. **觀察回應**
   - 等待 AI 回應（應顯示載入動畫）
   - 查看 AI 回覆內容

### 預期結果

#### ✅ 前端驗證

1. **聊天視窗功能**
   - 浮動按鈕應正常顯示在右下角
   - 點擊後應開啟/關閉聊天視窗
   - 聊天視窗應包含：
     - 標題列（琥珀色背景，顯示「AI 客服」）
     - 聊天記錄區域（初始顯示歡迎訊息）
     - 輸入框和發送按鈕

2. **訊息顯示**
   - 用戶訊息應顯示在右側（琥珀色背景）
   - AI 訊息應顯示在左側（白色背景）
   - 載入時應顯示跳動的點動畫

#### ✅ 後端驗證

1. **AI 回應驗證**
   - AI 應回覆一條**友善且相關**的訊息
   - 回應應與「Modern Brunch Place」相關
   - 回應應使用繁體中文（或根據系統提示詞的語言）
   - **請截圖 AI 回應內容**

2. **錯誤處理**
   - 如果 API 呼叫失敗，應顯示錯誤訊息
   - 如果 `GEMINI_API_KEY` 未設定，應顯示相應錯誤

---

## 🔍 測試檢查清單

### 預約系統檢查清單

- [ ] 前端表單可以正常填寫
- [ ] 提交按鈕可以正常點擊
- [ ] 成功訊息正確顯示（包含 calendarLink）
- [ ] Google Sheets 有新的資料行寫入
- [ ] Google Sheets 資料格式正確（8 個欄位）
- [ ] Google Calendar 有新的活動創建
- [ ] 日曆活動標題和描述正確
- [ ] 日曆活動時間正確

### AI 客服系統檢查清單

- [ ] 浮動按鈕正常顯示
- [ ] 聊天視窗可以正常開啟/關閉
- [ ] 可以正常輸入訊息
- [ ] 訊息可以正常發送
- [ ] AI 回應正常顯示
- [ ] AI 回應內容相關且友善
- [ ] 載入動畫正常顯示
- [ ] 錯誤處理正常運作

---

## 🐛 常見問題排查

### 預約系統問題

#### 問題 1：前端顯示「預約失敗」
- **檢查項目**：
  1. 開啟瀏覽器開發者工具（F12）→ Console 標籤
  2. 查看是否有錯誤訊息
  3. 檢查 Network 標籤，查看 `/api/reservation` 請求的狀態碼和回應

#### 問題 2：Google Sheets 沒有寫入資料
- **檢查項目**：
  1. 確認 `GOOGLE_SHEETS_ID` 正確
  2. 確認 `GOOGLE_SERVICE_ACCOUNT_EMAIL` 正確
  3. 確認 `GOOGLE_SERVICE_ACCOUNT_KEY` 格式正確（包含換行符）
  4. 確認服務帳號有權限存取該試算表
  5. 確認工作表名稱 `Brunch_Reservations` 正確

#### 問題 3：Google Calendar 沒有創建活動
- **檢查項目**：
  1. 確認 `GOOGLE_CALENDAR_ID` 正確
  2. 確認服務帳號有權限在該日曆中創建活動
  3. 檢查伺服器端 Console 是否有錯誤訊息

### AI 客服系統問題

#### 問題 1：AI 沒有回應
- **檢查項目**：
  1. 確認 `GEMINI_API_KEY` 已設定
  2. 確認 API 金鑰有效
  3. 檢查瀏覽器 Console 是否有錯誤
  4. 檢查 Network 標籤，查看 `/api/ai-chat` 請求的狀態碼

#### 問題 2：回應內容不符合預期
- **檢查項目**：
  1. 確認系統提示詞（systemInstruction）正確
  2. 確認使用的模型是 `gemini-2.0-flash`
  3. 檢查 API 回應的原始內容

---

## 📸 測試結果回報格式

請提供以下截圖或文字：

### 1. Google Sheets 截圖
- 顯示 `Brunch_Reservations` 工作表的最新一筆資料
- 應清楚顯示所有 8 個欄位（A-H）

### 2. Google Calendar 截圖
- 顯示新創建的預約活動
- 應清楚顯示活動標題、描述和時間

### 3. AI 客服回應截圖
- 顯示聊天視窗
- 應清楚顯示用戶問題和 AI 回應

---

## 🎯 測試完成標準

當以下所有項目都通過時，測試視為成功：

1. ✅ 預約表單可以正常提交
2. ✅ Google Sheets 成功寫入資料（格式正確）
3. ✅ Google Calendar 成功創建活動
4. ✅ AI 客服可以正常回應問題
5. ✅ 所有錯誤處理機制正常運作

---

## 📝 測試記錄範本

```
測試日期：2025-01-XX
測試人員：[您的名稱]

【預約系統測試】
- 表單提交：✅ 成功 / ❌ 失敗
- Sheets 寫入：✅ 成功 / ❌ 失敗
- Calendar 創建：✅ 成功 / ❌ 失敗
- 備註：[如有問題，請記錄]

【AI 客服系統測試】
- 聊天視窗：✅ 正常 / ❌ 異常
- API 呼叫：✅ 成功 / ❌ 失敗
- AI 回應：✅ 正常 / ❌ 異常
- 備註：[如有問題，請記錄]
```

---

**祝測試順利！** 🎉










