# 【測試結果：失敗】

## 1. 終端機錯誤日誌 (核心情報，請完整複製)

**⚠️ 重要：** 請從運行 `npm run dev` 的終端機窗口中，完整複製以下內容：

### 需要複製的日誌範圍：

從看到以下訊息開始：
```
📝 收到預約請求
```

到看到以下訊息結束：
```
POST /api/reservation 500 in XXXXms
```

**請將完整的終端機輸出貼在下方：**

```
[請在此處貼上完整的終端機錯誤日誌]

範例格式：
📝 收到預約請求
📋 接收到的資料: {...}
🔐 開始 Google 身份驗證...
📋 環境變數讀取檢查:
  GOOGLE_SERVICE_ACCOUNT_EMAIL: ❌ 未設定
  GOOGLE_SERVICE_ACCOUNT_KEY: ❌ 未設定
❌ 預約寫入失敗:
錯誤訊息: GOOGLE_SERVICE_ACCOUNT_KEY 環境變數未設定
錯誤堆疊: Error: GOOGLE_SERVICE_ACCOUNT_KEY 環境變數未設定
    at POST (webpack-internal:///(rsc)/./app/api/reservation/route.ts:62:19)
    ...
環境變數檢查:
  GOOGLE_SHEETS_ID: ❌ 未設定
  GOOGLE_CALENDAR_ID: ❌ 未設定
  GOOGLE_SERVICE_ACCOUNT_EMAIL: ❌ 未設定
  GOOGLE_SERVICE_ACCOUNT_KEY: ❌ 未設定
POST /api/reservation 500 in 4379ms
```

---

## 2. 權限確認

**服務帳號 Email：** `places-api-service@localbizfinder-477001.iam.gserviceaccount.com`

**請確認該服務帳號在 Google Sheet (`Reservations_v2_MAIN`) 中的權限狀態：**

- [ ] **已確認為編輯者** - 服務帳號已存在，權限為「編輯者」
- [ ] **權限不足** - 服務帳號存在，但權限為「檢視者」或「註解者」
- [ ] **服務帳號不存在** - 在共用列表中找不到該服務帳號

**請填寫：**
```
權限狀態：[請選擇上述其中一項]
```

**檢查步驟：**
1. 開啟 Google Sheets
2. 找到試算表（使用 `GOOGLE_SHEETS_ID`）
3. 點擊右上角「共用」按鈕
4. 在「與使用者和群組共用」區域中查找服務帳號 Email
5. 確認權限等級

---

## 3. 其他觀察

**請填寫任何其他觀察到的問題：**

- [ ] 前端是否有顯示錯誤提示框？如有，請描述錯誤訊息
- [ ] 瀏覽器 Console（F12）是否有錯誤訊息？如有，請描述
- [ ] 是否有其他異常行為？請描述

**請填寫：**
```
[請在此處填寫其他觀察到的問題]
```

---

## 📋 如何獲取終端機日誌

### 方法 1：直接複製（推薦）

1. **找到運行 `npm run dev` 的終端機窗口**
2. **提交測試預約單**
3. **立即在終端機中：**
   - 選取所有相關日誌（從「📝 收到預約請求」到「POST /api/reservation 500」）
   - 按 `Ctrl + C` 複製（Windows）或 `Cmd + C`（Mac）
   - 貼到此報告中

### 方法 2：截圖

1. **提交測試預約單**
2. **立即截圖終端機窗口**（顯示所有錯誤訊息）
3. **將截圖附在此報告中**

### 方法 3：導出日誌檔案

如果終端機支援導出：
1. 右鍵點擊終端機標題列
2. 選擇「匯出」或「儲存日誌」
3. 將檔案內容貼到此報告中

---

## ⚠️ 重要提醒

1. **必須完整複製** - 不要只複製部分內容
2. **包含所有錯誤訊息** - 特別是：
   - 錯誤訊息（error.message）
   - 錯誤堆疊（error.stack）
   - 完整錯誤物件
   - 環境變數檢查結果
3. **立即複製** - 提交預約後立即複製，避免日誌被新訊息覆蓋

---

**請完成以上報告並回報給 CTO！**










