/// 規則錨點（P0）
/// - MenuPeriod 決定「可販售時段」
/// - StaffShift 決定「可服務人力」
/// - v1 不做任何外鍵或關聯
/// - v2 才會引入關聯與約束（FK / relation）

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===== 既有 Models =====

model Resource {
  id          String   @id @default(uuid())
  name        String
  description String?
  type        String   @default("restaurant")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Reservation {
  id              String            @id @default(cuid())
  customerName    String
  phone           String
  peopleCount     Int
  reservedStart   DateTime
  reservedEnd     DateTime
  status          ReservationStatus @default(PENDING)
  calendarEventId String?
  notes           String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

// ===== 客服機器人相關 Models =====

enum ChatRole {
  USER
  BOT
  STAFF
}

enum ChatStatus {
  OPEN // 進行中
  ESCALATED // 已標記需要人工處理
  CLOSED // 已結案
}

model SupportTemplate {
  id        String   @id @default(cuid())
  title     String // 店長看到的標題，例如「寵物政策回答」
  prompt    String // 客戶可能會問的關鍵句或問題描述
  reply     String // 機器人要回的文字（繁體中文）
  tags      Json // 關鍵字陣列，例如 ["寵物", "狗", "貓"]（SQLite 使用 Json 類型）
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ChatSession {
  id        String    @id @default(cuid())
  startedAt DateTime  @default(now())
  endedAt   DateTime?
  channel   String    @default("web")
  userAgent String? // 一定要可為 null，避免建立時必填
  needHuman Boolean   @default(false)

  messages ChatMessage[]
}

model ChatMessage {
  id        String      @id @default(cuid())
  sessionId String
  session   ChatSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  role      String
  content   String
  createdAt DateTime @default(now())
}

/// StaffShift v1 (stable) - 排班基礎模型，勿隨意更動
/// v2 可能關聯：MenuPeriod（以時段對齊排班）
model StaffShift {
  id        String   @id @default(cuid())
  staffName String
  shiftDate DateTime
  startTime String
  endTime   String
  createdAt DateTime @default(now())
}

/// MenuPeriod v1 (stable) - 菜單時段基礎模型，勿隨意更動
/// v2 可能關聯：StaffShift、Reservation
model MenuPeriod {
  id        String   @id @default(cuid())
  name      String
  startTime String
  endTime   String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
}
