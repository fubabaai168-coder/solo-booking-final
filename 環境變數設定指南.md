# 環境變數設定指南

## 🔴 問題診斷

根據終端機輸出，所有環境變數都顯示為「❌ 未設定」：
- `GOOGLE_SHEETS_ID`: ❌ 未設定
- `GOOGLE_CALENDAR_ID`: ❌ 未設定
- `GOOGLE_SERVICE_ACCOUNT_EMAIL`: ❌ 未設定
- `GOOGLE_SERVICE_ACCOUNT_KEY`: ❌ 未設定

## 📋 解決步驟

### 步驟 1：創建 `.env.local` 檔案

在 `soloai-website` 目錄下創建一個名為 `.env.local` 的檔案（注意：檔案名前面有一個點）。

### 步驟 2：填入環境變數

將以下內容複製到 `.env.local` 檔案中，並填入您的實際值：

```bash
# Google Sheets API 設定
GOOGLE_SHEETS_ID=your-spreadsheet-id-here

# Google Calendar API 設定
GOOGLE_CALENDAR_ID=your-calendar-id@group.calendar.google.com

# Google Service Account 設定
GOOGLE_SERVICE_ACCOUNT_EMAIL=your-service-account@project-id.iam.gserviceaccount.com
GOOGLE_SERVICE_ACCOUNT_KEY="-----BEGIN PRIVATE KEY-----\nYOUR_PRIVATE_KEY_HERE\n-----END PRIVATE KEY-----\n"

# Google Gemini API 設定
GEMINI_API_KEY=your-gemini-api-key-here
```

### 步驟 3：取得環境變數值

#### 3.1 Google Sheets ID

1. 開啟您的 Google Sheets
2. 查看網址列，例如：`https://docs.google.com/spreadsheets/d/1ABC123XYZ789/edit`
3. `1ABC123XYZ789` 就是您的 `GOOGLE_SHEETS_ID`

#### 3.2 Google Calendar ID

1. 開啟 Google Calendar
2. 點擊「設定」→「我的日曆」
3. 找到您要使用的日曆，點擊「整合日曆」
4. 複製「日曆 ID」（通常是 Email 格式，例如：`your-calendar@group.calendar.google.com`）

#### 3.3 Google Service Account

**方法 A：使用現有的 JSON 檔案**

如果您有服務帳號 JSON 檔案（例如：`localbizfinder-477001-40e17afc46ea.json.json`）：

1. 開啟 JSON 檔案
2. 複製 `client_email` 的值作為 `GOOGLE_SERVICE_ACCOUNT_EMAIL`
3. 複製 `private_key` 的值作為 `GOOGLE_SERVICE_ACCOUNT_KEY`（**保持完整格式，包含換行符**）

**方法 B：從 Google Cloud Console 創建**

1. 前往 [Google Cloud Console](https://console.cloud.google.com/)
2. 選擇您的專案
3. 導航至「IAM 與管理」→「服務帳號」
4. 創建新的服務帳號或選擇現有的
5. 點擊「金鑰」→「新增金鑰」→「JSON」
6. 下載 JSON 檔案並提取 `client_email` 和 `private_key`

#### 3.4 Gemini API Key

1. 前往 [Google AI Studio](https://makersuite.google.com/app/apikey)
2. 創建新的 API 金鑰
3. 複製金鑰作為 `GEMINI_API_KEY`

### 步驟 4：設定 GOOGLE_SERVICE_ACCOUNT_KEY 格式

**重要：** `GOOGLE_SERVICE_ACCOUNT_KEY` 必須保持完整的私鑰格式，包括換行符。

有兩種方式設定：

#### 方式 1：使用雙引號（推薦）

```bash
GOOGLE_SERVICE_ACCOUNT_KEY="-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC...\n-----END PRIVATE KEY-----\n"
```

#### 方式 2：使用實際換行（如果您的編輯器支援）

```bash
GOOGLE_SERVICE_ACCOUNT_KEY="-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC...
-----END PRIVATE KEY-----
"
```

### 步驟 5：重新啟動開發伺服器

**重要：** 修改 `.env.local` 後，必須重新啟動開發伺服器才能載入新的環境變數。

1. 停止當前的開發伺服器（按 `Ctrl + C`）
2. 重新啟動：
   ```bash
   cd soloai-website
   npm run dev
   ```

## ✅ 驗證設定

重新啟動伺服器後，提交預約表單，檢查終端機輸出。您應該會看到：

```
📋 環境變數讀取檢查:
  GOOGLE_SERVICE_ACCOUNT_EMAIL: your-service-account@project-id.iam.gserviceaccount.com
  GOOGLE_SERVICE_ACCOUNT_KEY:
    長度: 1679 字符
    前 50 字符預覽: -----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0...
    是否包含換行符: 是
    是否包含 \n 字串: 否
```

如果仍然顯示「❌ 未設定」，請檢查：

1. ✅ `.env.local` 檔案是否在 `soloai-website` 目錄下（不是 `soloai-project`）
2. ✅ 檔案名稱是否正確（`.env.local`，前面有點）
3. ✅ 是否已重新啟動開發伺服器
4. ✅ 環境變數名稱是否正確（大小寫敏感）
5. ✅ 是否有語法錯誤（例如：缺少引號、多餘的空格）

## 🔒 安全注意事項

- ⚠️ **永遠不要**將 `.env.local` 檔案提交到 Git
- ⚠️ `.env.local` 應該已經在 `.gitignore` 中
- ⚠️ 不要分享您的私鑰或 API 金鑰

## 📝 範例 .env.local 檔案

```bash
# Google Sheets API 設定
GOOGLE_SHEETS_ID=1ABC123XYZ789abcdefghijklmnopqrstuvwxyz

# Google Calendar API 設定
GOOGLE_CALENDAR_ID=your-calendar@group.calendar.google.com

# Google Service Account 設定
GOOGLE_SERVICE_ACCOUNT_EMAIL=localbizfinder@localbizfinder-477001.iam.gserviceaccount.com
GOOGLE_SERVICE_ACCOUNT_KEY="-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC...\n-----END PRIVATE KEY-----\n"

# Google Gemini API 設定
GEMINI_API_KEY=AIzaSyAbCdEfGhIjKlMnOpQrStUvWxYz1234567
```

## 🆘 仍然無法載入？

如果重新啟動後仍然無法載入環境變數，請檢查：

1. **Next.js 版本：** 確認使用 Next.js 14.x（支援 `.env.local`）
2. **檔案位置：** `.env.local` 必須在專案根目錄（與 `package.json` 同級）
3. **檔案編碼：** 確保檔案使用 UTF-8 編碼
4. **語法錯誤：** 檢查是否有未配對的引號或特殊字符

---

**完成設定後，請重新啟動開發伺服器並再次測試預約功能！** 🚀










