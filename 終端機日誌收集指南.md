# 📋 終端機日誌收集指南

## ⚠️ 重要說明

**我（Cursor AI）無法直接訪問運行中的終端機輸出。** 需要您手動提供終端機日誌。

---

## 🎯 快速步驟（3 分鐘完成）

### 步驟 1：找到終端機窗口

1. **找到運行 `npm run dev` 的終端機窗口**
   - 通常顯示：`✓ Ready in X.Xs`
   - 顯示：`- Local: http://localhost:3000`

### 步驟 2：提交測試預約單

1. **開啟瀏覽器**：`http://localhost:3000/reservation`
2. **填寫表單**：
   - 姓名：`測試用戶`
   - 電話：`0912345678`
   - 日期：選擇未來日期
   - 時段：選擇任一時段
   - 人數：`2`
3. **點擊「提交預約」**
4. **立即切換到終端機窗口**（不要等待）

### 步驟 3：複製錯誤日誌

**在終端機中：**

1. **找到以下開始標記：**
   ```
   📝 收到預約請求
   ```

2. **向下滾動，找到以下結束標記：**
   ```
   POST /api/reservation 500 in XXXXms
   ```

3. **選取整個範圍**（從開始標記到結束標記）

4. **複製**：
   - **Windows**: 選取後按 `Enter` 或 `Ctrl + C`
   - **Mac**: 選取後按 `Cmd + C`

5. **貼到此處：**

---

## 📝 請將終端機日誌貼在下方

```
[請在此處貼上完整的終端機錯誤日誌]

請確保包含：
- 📝 收到預約請求
- 📋 接收到的資料
- 🔐 開始 Google 身份驗證...
- 📋 環境變數讀取檢查
- ❌ 預約寫入失敗
- 錯誤訊息
- 錯誤堆疊
- 完整錯誤物件
- 環境變數檢查
- POST /api/reservation 500 in XXXXms
```

---

## 🖥️ 不同終端機的複製方法

### Windows PowerShell / CMD

1. **在終端機中，按住滑鼠左鍵**
2. **拖曳選取所有相關日誌**
3. **按 `Enter` 複製**（CMD 會自動複製選取的內容）
4. **或按 `Ctrl + C`**

### Windows Terminal

1. **右鍵點擊終端機標題列**
2. **選擇「標記」**
3. **選取日誌區域**
4. **按 `Enter` 複製**

### VS Code 終端機

1. **在終端機中選取文字**
2. **右鍵點擊選取的文字**
3. **選擇「複製」**
4. **或按 `Ctrl + C`**

---

## 📸 如果無法複製文字，請截圖

### Windows 截圖

1. **按 `Win + Shift + S`**（Windows 截圖工具）
2. **選取終端機窗口的錯誤區域**
3. **截圖會自動複製到剪貼簿**
4. **貼到報告中**

### 全螢幕截圖

1. **按 `Print Screen`**（PrtScn）
2. **開啟畫圖工具**
3. **按 `Ctrl + V` 貼上**
4. **儲存並附在報告中**

---

## 📋 預期的日誌格式

根據程式碼，您應該會看到類似以下的內容：

### 如果環境變數未設定：

```
📝 收到預約請求
📋 接收到的資料: {
  "name": "測試用戶",
  "phone": "0912345678",
  "date": "2025-01-16",
  "time": "11:30-14:00",
  "guests": 2,
  "notes": ""
}
🔐 開始 Google 身份驗證...
📋 環境變數讀取檢查:
  GOOGLE_SERVICE_ACCOUNT_EMAIL: ❌ 未設定
  GOOGLE_SERVICE_ACCOUNT_KEY: ❌ 未設定
❌ 預約寫入失敗:
錯誤訊息: GOOGLE_SERVICE_ACCOUNT_KEY 環境變數未設定
錯誤堆疊: Error: GOOGLE_SERVICE_ACCOUNT_KEY 環境變數未設定
    at POST (webpack-internal:///(rsc)/./app/api/reservation/route.ts:62:19)
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
    ...
完整錯誤物件: {
  "message": "GOOGLE_SERVICE_ACCOUNT_KEY 環境變數未設定",
  "stack": "..."
}
環境變數檢查:
  GOOGLE_SHEETS_ID: ❌ 未設定
  GOOGLE_CALENDAR_ID: ❌ 未設定
  GOOGLE_SERVICE_ACCOUNT_EMAIL: ❌ 未設定
  GOOGLE_SERVICE_ACCOUNT_KEY: ❌ 未設定
POST /api/reservation 500 in 4379ms
```

### 如果 Google API 錯誤：

```
📝 收到預約請求
📋 接收到的資料: {...}
🔐 開始 Google 身份驗證...
📋 環境變數讀取檢查:
  GOOGLE_SERVICE_ACCOUNT_EMAIL: places-api-service@localbizfinder-477001.iam.gserviceaccount.com
  GOOGLE_SERVICE_ACCOUNT_KEY:
    長度: 1679 字符
    前 50 字符預覽: -----BEGIN PRIVATE KEY-----\n...
    是否包含換行符: 是
    是否包含 \n 字串: 否
📊 初始化 Google Sheets API...
📅 初始化 Google Calendar API...
⏰ 處理日期和時間...
📅 創建 Google 日曆事件...
✅ 日曆事件創建成功: ...
📊 寫入 Google Sheets...
   試算表 ID: your-spreadsheet-id
   工作表名稱: Reservations_v2_MAIN
   寫入資料: [...]
❌ 預約寫入失敗:
錯誤訊息: [Google API 錯誤訊息，例如：The caller does not have permission]
錯誤堆疊: Error: [錯誤訊息]
    at ...
完整錯誤物件: {
  "message": "[錯誤訊息]",
  "code": "[錯誤代碼]",
  ...
}
環境變數檢查:
  GOOGLE_SHEETS_ID: 已設定
  GOOGLE_CALENDAR_ID: 已設定
  GOOGLE_SERVICE_ACCOUNT_EMAIL: 已設定
  GOOGLE_SERVICE_ACCOUNT_KEY: 已設定
POST /api/reservation 500 in 4379ms
```

---

## ⚠️ 重要提醒

1. **立即複製** - 提交預約後立即複製，避免日誌被新訊息覆蓋
2. **完整複製** - 不要只複製部分內容，要包含所有錯誤訊息
3. **包含堆疊** - 確保包含錯誤堆疊（Stack Trace）
4. **包含環境變數檢查** - 確保包含「環境變數檢查」部分

---

**請按照以上步驟獲取終端機日誌，並貼到報告中！**










